<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../../bower_components/paper-radio-group/paper-radio-group.html">

<dom-module id="tangy-checkboxes">
  <template>
    <style>
      :host {
        display: block;
        margin: 15px 0 15px;
      }
      :host([hidden]) {
        display: none;
      }
      :host([invalid]) {
        border: red solid 3px;
      }
      paper-radio-button {
        display: block;
      }
      label {
        display: block;
        font-size: 1.2em;
      }
      :host([disabled]) label {
        color: #FFF 

      }
    </style>
    <label for="group">[[label]]</label>
    <div id="checkboxes">
      <slot></slot>
    </div>
    
  </template>

  <script>
    /**
     * `tangy-checkboxes`
     * 
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class TangyCheckboxes extends Polymer.Element {

      static get is() { return 'tangy-checkboxes'; }

      static get properties() {
        return {
          name: {
            type: String,
            value: ''
          },
          // @TODO Need value? Really?
          value: {
            type: String,
            value: '',
            reflectToAttribute: true
          },
          atLeast: {
            type: Number,
            value: 0,
            reflectToAttribute: true
          },
          required: {
            type: Boolean,
            value: false
          },
          disabled: {
            type: Boolean,
            value: false,
            observer: 'onDisabledChange',
            reflectToAttribute: true
          },
          label: {
            type: String,
            value: '',
            reflectToAttribute: true
          },
          hidden: {
            type: Boolean,
            value: false,
            observer: 'onHiddenChange',
            reflectToAttribute: true
          },
          invalid: {
            type: Boolean,
            value: false,
            reflectToAttribute: true
          }
        }
      }

      connectedCallback() {
        super.connectedCallback()
        this.querySelectorAll('tangy-checkbox').forEach(checkbox => {
          checkbox.addEventListener('change', this.onCheckboxChange.bind(this))
        })

      }

      onCheckboxChange(checkbox) {
        let checked = [].slice.call(this.querySelectorAll('tangy-checkbox')).filter(checkbox => checkbox.value !== '')
        this.value = checked.length
        this.dispatchEvent(new Event('change'))
      }

      onDisabledChange(value) {
        let paperCheckboxes = this.shadowRoot.querySelectorAll('tangy-checkbox')
        if (value == true) paperCheckboxes.forEach((button) => button.setAttribute('disabled', true))
        if (value == false) paperCheckboxes.forEach((button) => button.removeAttribute('disabled'))
      }
      onHiddenChange(value) {
        // Disable when hidden so values do not end up being saved when hidden.
        this.disabled = value
        let paperCheckboxes = this.shadowRoot.querySelectorAll('tangy-checkbox')
      }

      validate() {
        if (this.hidden || this.disabled) return true
        if (this.atLeast === 0 && !this.required) return true
        let checked = [].slice.call(this.querySelectorAll('tangy-checkbox')).filter(checkbox => checkbox.value !== '')
        if (this.atLeast === 0 && this.required && checked.length > 0) return true
        if(checked.length >= this.atLeast) return true
        return false
      }

    }
    window.customElements.define(TangyCheckboxes.is, TangyCheckboxes );
  </script>
</dom-module>
