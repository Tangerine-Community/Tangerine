<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">

<dom-module id="tangy-checkbox">
  <template>
    <style>
      :host {
        display: block;
      }
      :host([hidden]) {
        display: none;
      }
      :host([required]:not([disabled])) label::before  { 
        content: "*"; 
        color: red; 
        position: absolute;
        top: 4px;
        right: 5px;
      }
    </style>
    <paper-checkbox id="checkbox"><slot></slot></paper-checkbox>
  </template>

  <script>
    /**
     * `tangy-checkbox`
     * 
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class TangyCheckbox extends Polymer.Element {

      static get is() { return 'tangy-checkbox'; }

      static get properties() {
        return {
          name: {
            type: String,
            value: ''
          },
          required: {
            type: Boolean,
            value: false,
            observer: 'onRequiredChange',
            reflectToAttribute: true
          },
          disabled: {
            type: Boolean,
            value: false,
            observer: 'onDisabledChange',
            reflectToAttribute: true
          },
          invalid: {
            type: Boolean,
            value: false,
            observer: 'onInvalidChange',
            reflectToAttribute: true
          },
          hidden: {
            type: Boolean,
            value: false,
            reflectToAttribute: true
          },
          value: {
            type: String,
            value: '',
            observer: 'onValueChange',
            reflectToAttribute: true
          },

        }
      }

      connectedCallback() {
        super.connectedCallback()
        if (this.value) this.$.checkbox.checked = true
        this.$.checkbox.addEventListener('change', (e) => {
          e.stopPropagation()
          this.dispatchEvent(new CustomEvent('INPUT_VALUE_CHANGE', {
            bubbles: true, 
            detail: {
              inputName: this.name,
              inputValue: (e.target.checked) ? true : false,
              inputInvalid: !this.$.checkbox.validate()
            }
          }))
        })
      }

      onRequiredChange(value) {
        if (value === false) {
          this.$.checkbox.removeAttribute('required')
        } else {
          this.$.checkbox.setAttribute('required', true)
        }
      }

      onInvalidChange(value) {
        if (value === false) {
          this.$.checkbox.removeAttribute('invalid')
        } else {
          this.$.checkbox.setAttribute('invalid', true)
        }
      }

      onDisabledChange(value) {
        if (value === false) {
          this.$.checkbox.removeAttribute('disabled')
        } else {
          this.$.checkbox.setAttribute('disabled', true)
        }
      }

      onValueChange(value) {
        if (value) this.$.checkbox.setAttribute('checked', true) 
        if (!value) this.$.checkbox.removeAttribute('checked')
      }

    }
    window.customElements.define(TangyCheckbox.is, TangyCheckbox);
  </script>
</dom-module>
