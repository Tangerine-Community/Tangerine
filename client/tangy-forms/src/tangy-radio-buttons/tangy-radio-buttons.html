<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../tangy-form/tangy-element-styles.html">

<dom-module id="tangy-radio-buttons">
  <template>

    <style include="tangy-element-styles"></style>

    <style>
      paper-radio-button {
        margin-right: 25px;
        --paper-radio-button-size: 2em;
      }
    </style>

    <div class="container">
      <label for="group">[[label]]</label>
      <paper-radio-group name="group" id="paper-radio-group">
      </paper-radio-group>
    </div>
    
  </template>

  <script>
    /**
     * `tangy-radio-buttons`
     * 
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class TangyRadioButtons extends Polymer.Element {

      static get is() { return 'tangy-radio-buttons'; }

      static get properties() {
        return {
          name: {
            type: String,
            value: ''
          },
          value: {
            type: String,
            value: '',
            reflectToAttribute: true,
            observer: 'onValueChange'
          },
          required: {
            type: Boolean,
            value: false
          },
          disabled: {
            type: Boolean,
            value: false,
            observer: 'onDisabledChange',
            reflectToAttribute: true
          },
          label: {
            type: String,
            value: '',
            reflectToAttribute: true
          },
          hidden: {
            type: Boolean,
            value: false,
            observer: 'onHiddenChange',
            reflectToAttribute: true
          },
          invalid: {
            type: Boolean,
            value: false,
            reflectToAttribute: true
          }
        }
      }

      connectedCallback() {
        super.connectedCallback()
        this.isReady = false
        let paperRadioGroupEl = this.shadowRoot.querySelector('paper-radio-group')
        paperRadioGroupEl.addEventListener('change', this.onPaperRadioGroupChange.bind(this), false)
        // Populate options as paper-radio-button elements
        let options = this.querySelectorAll('option')
        for (let option of options) {
          let button = document.createElement('paper-radio-button')
          button.name = option.value
          if (this.disabled) button.setAttribute('disabled', true)
          button.innerHTML = option.innerHTML
          paperRadioGroupEl.appendChild(button)
        }
        paperRadioGroupEl.selected = this.value
        if (this.required) paperRadioGroupEl.required = true
        this.isReady = true
      }

      onPaperRadioGroupChange(event) {
        // Stop propagation of paper-radio-button change event so we can set the value of this element first.
        // Otherwise tangy-form-item will find the wrong value for this element.
        event.stopPropagation()
        if (!this.isReady) return
        // The value we dispatch is the event.target.name. Remember, that's the option that was just selected
        // and the option's name selected is the value of this element.
        this.dispatchEvent(new CustomEvent('INPUT_VALUE_CHANGE', {
          detail: {
            inputName: this.name,
            inputValue: event.target.name
          },
          bubbles:true
        }))
      }

      onValueChange(value) {
        if (!this.isReady) return
        this.$['paper-radio-group'].selected = value
      }

      onDisabledChange(value) {
        let paperRadioButtons = this.shadowRoot.querySelectorAll('paper-radio-button')
        if (value == true) paperRadioButtons.forEach((button) => button.setAttribute('disabled', true))
        if (value == false) paperRadioButtons.forEach((button) => button.removeAttribute('disabled'))
      }
      onHiddenChange(value) {
      }

    }
    window.customElements.define(TangyRadioButtons.is, TangyRadioButtons);
  </script>
</dom-module>
