<mat-card class="tangy-card-content-container">
  <div class="attendance-report-div">
    <h1>{{'Attendance'|translate}}</h1>

    <!--    <div *ngFor="let attendanceReport of attendanceReports" class="attendance-report-div">-->

    <!--      <div *ngFor="let attendanceReport of attendanceReports">-->
<!--    <div style="margin-bottom:1em">-->
<!--      <h3>{{'Legend'|translate}} </h3>-->
<!--      <p>{{'Student behaviour is calculated according to the following rules and color-coding: '|translate}}</p>-->
<!--      <table class="legend">-->
<!--        <tr>-->
<!--          <td class="red"></td>-->
<!--          <td>{{'Score is < 33'|translate}}</td>-->
<!--        </tr>-->
<!--        <tr>-->
<!--          <td class="orange"></td>-->
<!--          <td>{{'Score is > 33 and < 67'|translate}}</td>-->
<!--        </tr>-->
<!--        <tr>-->
<!--          <td class="green"></td>-->
<!--          <td>{{'Score is > 67'|translate}}</td>-->
<!--        </tr>-->
<!--      </table>-->
<!--    </div>-->
    <div>
      <h3>{{'Attendance Summary'|translate}} </h3>
      <table class="subtest">
        <tr>
          <td colspan="1">&nbsp;</td>
          <td colspan="2">{{'Most Recent Class'|translate}}: {{attendanceReport?._id.split('-')[2]}}
            -{{attendanceReport?._id.split('-')[3]}}-{{attendanceReport?._id.split('-')[4]}}</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <th>{{'Student'|translate}}</th>
          <th>{{'Attendance'|translate}}</th>
          <th>{{'Behavior'|translate}}</th>
          <th>{{scoreReport?.testName}}</th>
          <th *ngFor="let form of curriculi">
            {{form.label}}
          </th>
        </tr>
        <tr *ngFor="let student of attendanceReport?.attendanceList">
          <td>{{student.name}}</td>
          <td [ngClass]="{'red': student.absent, 'green': !student.absent}"></td>
          <td
            [ngClass]="{'red': student.mood === 'sad', 'orange': student.mood === 'neutral', 'green': student.mood === 'happy'}"></td>
          <td [ngClass]="{'red': student.score < 60, 'orange': (student.score >=60 && student.score < 80), 'green': student.score > 79}">{{student.score}}</td>
          <td>
            <ng-container *ngFor="let score of student.studentScores | keyvalue">
              <!--            {{score.key}}:{{score.value}}-->
              <ng-container *ngFor="let val of score.value">{{val.score}} %</ng-container>
            </ng-container>
          </td>
        </tr>
      </table>
      <p>&nbsp;</p>
      <table class="subtest">
        <tr>
          <td colspan="1">&nbsp;</td>
          <td colspan="2">{{'Past 30 days'|translate}}</td>
        </tr>
        <tr>
          <th>{{'Student'|translate}}</th>
          <th>{{'Attendance'|translate}}</th>
          <th>{{'Behavior'|translate}}</th>
        </tr>
        <tr *ngFor="let student of attendanceReport?.attendanceList">
          <td>{{student.name}}</td>
          <td
            [ngClass]="{'red': student.presentPercentage < 21, 'green': student.presentPercentage > 79}"> {{student.presentPercentage}}
            %
          </td>
          <td
            [ngClass]="{'red': student.moodPercentage <=20, 'orange': (student.moodPercentage >=20 && student.moodPercentage < 90), 'green': student.moodPercentage >=90}"> {{student.moodPercentage}}
            %
          </td>
        </tr>
      </table>
    </div>

    <div id="last-n-report">
      <h3>{{'Most recent'|translate}} {{numVisits}} {{'visits'|translate}}</h3>
      <table class="subtest">
        <tr>
          <td colspan="2">
            {{'Enter number of attendance reports to query'|translate}}
          </td>
          <td colspan="1">
            <form class="num-visits-form">
              <mat-form-field>
                <input [(ngModel)]="numVisits" matInput type="number" placeholder="Ex. 3"
                       (ngModelChange)="onNumberVisitsChange($event)" [ngModelOptions]="{standalone: true}">
              </mat-form-field>
            </form>
          </td>
        </tr>
        <tr *ngIf="recentVisitsReport">
          <td colspan="3">{{'Attendance reports queried'|translate}}: {{recentVisitsReport?.attendanceList.length}}</td>
        </tr>
        <tr>
          <th>{{'Student'|translate}}</th>
          <th>{{'Attendance'|translate}}</th>
          <th>{{'Behavior'|translate}}</th>
        </tr>

        <tr *ngFor="let student of recentVisitsReport?.attendanceList">
          <td>{{student.name}}</td>
          <td
            [ngClass]="{'red': student.presentPercentage < 21, 'green': student.presentPercentage > 79}"> {{student.presentPercentage}}
            %
          </td>
          <td
            [ngClass]="{'red': student.moodPercentage <=20, 'orange': (student.moodPercentage >=20 && student.moodPercentage < 90), 'green': student.moodPercentage >=90}"> {{student.moodPercentage}}
            %
          </td>
        </tr>
      </table>
    </div>
  </div>
</mat-card>
