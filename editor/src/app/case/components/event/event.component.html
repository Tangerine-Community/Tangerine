<div *ngIf="loaded">
  <app-case-breadcrumb *ngIf="caseService && caseService.case && caseService.case._id" [caseId]="caseService.case._id" [caseEventId]="caseEvent.id"></app-case-breadcrumb>
  <div  class="subject-header">
    <span id="event-actions">
      <span *ngIf="caseEvent.archived" class="archived">
        [ Archived ]
        <paper-button class="button" mat-icon-button (click)="unarchive()" *ngIf="authenticationService.doesUserHaveAPermission(groupId, 'can_unarchive_cases')">
          <i class="material-icons mat-32 tangy-location-list-icon">unarchive</i> Unarchive 
        </paper-button>
      </span>
      <!--
      <paper-button class="button" mat-icon-button (click)="delete()" *ngIf="authenticationService.doesUserHaveAPermission(groupId, 'can_delete_cases') && !caseEvent.archived">
        <i class="material-icons mat-32 tangy-location-list-icon">delete</i> Delete
      </paper-button>
      -->
      <paper-button class="button" mat-icon-button (click)="archive()" *ngIf="authenticationService.doesUserHaveAPermission(groupId, 'can_archive_cases') && !caseEvent.archived">
        <i class="material-icons mat-32 tangy-location-list-icon">archive</i>  Archive
      </paper-button>
    </span>
  </div>
  <app-case-notifications></app-case-notifications>
  <div class="wrapper">
    <div class="screen" *ngIf="hasNotificationEnforcingAttention"></div>
    <app-event-form-list-item
      *ngFor="let eventFormInfo of noRoleEventFormInfos"
      [case]="caseService.case"
      [caseDefinition]="caseService.caseDefinition"
      [caseEvent]="caseEvent"
      [caseEventDefinition]="caseEventDefinition"
      [eventForm]="eventFormInfo.eventForm"
      [eventFormDefinition]="eventFormInfo.eventFormDefinition"
      class="form {{eventFormInfo.eventFormDefinition.required ? 'required' : ''}}" 
      routerLink="/case/event/form/{{eventFormInfo.eventForm.caseId}}/{{eventFormInfo.eventForm.caseEventId}}/{{eventFormInfo.eventForm.id}}"
    >
    </app-event-form-list-item>
    <app-event-forms-for-participant
      [caseId]="caseService.case._id"
      [eventId]="caseEvent.id"
      [participantId]="participant.id"
      *ngFor="let participant of caseService.case.participants"
    >
    </app-event-forms-for-participant>
     
  </div>

</div>

<div *appHasAPermission="let i;group:groupId; permission:'can_restore_conflict_event'">
  <h2 *ngIf="conflictingEventForms?.length > 0 || archivedEventForms?.length > 0">Archived and Conflicting Event Forms</h2>
  <div *ngFor="let conflict of conflictingEventForms" class="icon-list-item conflict new-event">
    <mwc-icon slot="item-icon">receipt</mwc-icon>
    <div>
      <div><strong>{{conflict.eventFormDefinitionId}}</strong></div>
      <div>
        <div secondary>
          Complete: {{conflict.complete}}
          <span *ngFor="let eventForm of conflict.eventForms">
            ID: {{eventForm.formResponseId | slice:0:8}} Rev: {{conflict.conflictRevisionId| slice:0:8}}
          </span>
        </div>
        <div class="text-right">
          <paper-button (click)="onRestore(conflict)" [hidden]="hideRestore" class="button">{{'Restore'|translate}}</paper-button>
        </div>
      </div>
    </div>
  </div>
  <div *ngFor="let archivedEventForm of archivedEventForms" class="icon-list-item archive new-event">
    <mwc-icon slot="item-icon">archive</mwc-icon>
    <div>
      <div><strong>{{archivedEventForm.eventFormDefinitionId}}</strong></div>
      <div>
        <div secondary>
          Complete: {{archivedEventForm.complete}}
        </div>
        <div class="text-right">
          <paper-button (click)="onUnarchiveEventForm(archivedEventForm)" [hidden]="hideRestore" class="button">{{'Unarchive'|translate}}</paper-button>
        </div>
      </div>
    </div>
  </div>
</div>